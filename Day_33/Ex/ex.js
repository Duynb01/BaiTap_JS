var lyrics = {
  err: 0,
  msg: "Success",
  data: {
    sentences: [
      {
        words: [
          {
            startTime: 14310,
            endTime: 21810,
            data: "Sigan-i eolmana jinaneum ji",
          },
        ],
      },
      {
        words: [
          {
            startTime: 21810,
            endTime: 26940,
            data: "Geudae us-eum soliga tteoolla",
          },
        ],
      },
      {
        words: [
          {
            startTime: 26940,
            endTime: 33370,
            data: "Jinanji eolma an doel geosgatjiman",
          },
        ],
      },
      {
        words: [
          {
            startTime: 33370,
            endTime: 39810,
            data: "Neoul us-eum soliga deullyeowa",
          },
        ],
      },
      {
        words: [
          {
            startTime: 39810,
            endTime: 47250,
            data: "Ulineun neomuna dalkomhaess-eo",
          },
        ],
      },
      {
        words: [
          {
            startTime: 47250,
            endTime: 52620,
            data: "Balaess-eoss hangsang hamkke hagileul",
          },
        ],
      },
      {
        words: [
          {
            startTime: 52620,
            endTime: 58880,
            data: "Uliul salm-i kkeutnaneun naikkaji",
          },
        ],
      },
      {
        words: [
          {
            startTime: 58880,
            endTime: 64190,
            data: "Hamkke han it-eul somanghaess-eoseo",
          },
        ],
      },
      {
        words: [
          {
            startTime: 64870,
            endTime: 72120,
            data: "Bioneun geolieseo uli chueog deullinayu",
          },
        ],
      },
      {
        words: [
          {
            startTime: 72120,
            endTime: 78120,
            data: "Nan saeng-gagna haengboghaess-eossneunde",
          },
        ],
      },
      {
        words: [
          {
            startTime: 78120,
            endTime: 81750,
            data: "Uliuikkum-eun haengboghage",
          },
        ],
      },
      {
        words: [
          {
            startTime: 81750,
            endTime: 84940,
            data: "Jinaeneun ge jeonbuyeossneunde",
          },
        ],
      },
      {
        words: [
          {
            startTime: 84940,
            endTime: 90500,
            data: "Jigeum-eun nan ulilaneun ge jeongmal",
          },
        ],
      },
      {
        words: [
          {
            startTime: 90500,
            endTime: 97930,
            data: "Ulileul wihae gat-i geol-eossdeon geolien ije",
          },
        ],
      },
      {
        words: [
          {
            startTime: 97930,
            endTime: 103690,
            data: "Nageullgo ijen uimi eobs - eo",
          },
        ],
      },
      {
        words: [
          {
            startTime: 103690,
            endTime: 107180,
            data: "Tteonagi jeon-e malhaess-eosji",
          },
        ],
      },
      {
        words: [
          {
            startTime: 107180,
            endTime: 110070,
            data: "*** isang seulpeohalineun ma",
          },
        ],
      },
      {
        words: [
          {
            startTime: 110070,
            endTime: 114510,
            data: "Uliga hamkkeil su eobsda haedo",
          },
        ],
      },
      {
        words: [{ startTime: 129420, endTime: 131290, data: "Nhưng giờ đây" }],
      },
      {
        words: [
          { startTime: 131329, endTime: 131739, data: "Hai" },
          { startTime: 131739, endTime: 131779, data: "ta" },
          { startTime: 132079, endTime: 132459, data: "chia" },
          { startTime: 132459, endTime: 132779, data: "cách" },
          { startTime: 132779, endTime: 133369, data: "muôn" },
          { startTime: 133379, endTime: 134630, data: "trùng" },
          { startTime: 134630, endTime: 135040, data: "mây" },
        ],
      },
      {
        words: [
          { startTime: 136869, endTime: 137299, data: "Giấc" },
          { startTime: 137299, endTime: 137319, data: "mơ" },
          { startTime: 137319, endTime: 137349, data: "ngàn" },
          { startTime: 137349, endTime: 137369, data: "thu" },
          { startTime: 138590, endTime: 139019, data: "đón" },
          { startTime: 139029, endTime: 139409, data: "anh" },
          { startTime: 139419, endTime: 139829, data: "bình" },
          { startTime: 139829, endTime: 139849, data: "yên" },
          { startTime: 140109, endTime: 140379, data: "chốn" },
          { startTime: 140859, endTime: 140909, data: "ấy" },
        ],
      },
      {
        words: [
          { startTime: 142109, endTime: 142329, data: "Trong" },
          { startTime: 143069, endTime: 143099, data: "tương" },
          { startTime: 143099, endTime: 143169, data: "lai" },
          { startTime: 144189, endTime: 144599, data: "một" },
          { startTime: 144609, endTime: 144949, data: "mình" },
          { startTime: 144949, endTime: 145109, data: "em" },
          { startTime: 145149, endTime: 145779, data: "trên" },
          { startTime: 145779, endTime: 146099, data: "lối" },
          { startTime: 146099, endTime: 147370, data: "đi" },
          { startTime: 147370, endTime: 147450, data: "này" },
        ],
      },
      {
        words: [
          { startTime: 148550, endTime: 148930, data: "Thương" },
          { startTime: 149020, endTime: 149390, data: "nhớ" },
          { startTime: 149390, endTime: 149430, data: "hoài" },
          { startTime: 150579, endTime: 150869, data: "kỷ" },
          { startTime: 150869, endTime: 150949, data: "niệm" },
          { startTime: 150979, endTime: 151119, data: "xưa" },
        ],
      },
      {
        words: [
          { startTime: 151339, endTime: 151799, data: "Chung" },
          { startTime: 151869, endTime: 152129, data: "bước" },
          { startTime: 152139, endTime: 152809, data: "dưới" },
          { startTime: 153039, endTime: 153289, data: "mưa" },
          { startTime: 153289, endTime: 153309, data: "bay" },
        ],
      },
      {
        words: [
          { startTime: 154579, endTime: 154929, data: "Ngày" },
          { startTime: 155009, endTime: 155420, data: "hôm" },
          { startTime: 155459, endTime: 155919, data: "nao" },
          { startTime: 156129, endTime: 156529, data: "chia" },
          { startTime: 156569, endTime: 156969, data: "tay" },
          { startTime: 156979, endTime: 157229, data: "anh" },
          { startTime: 157229, endTime: 157429, data: "nói" },
        ],
      },
      {
        words: [
          { startTime: 157769, endTime: 158119, data: "Như" },
          { startTime: 158189, endTime: 158579, data: "lời" },
          { startTime: 158589, endTime: 158959, data: "trăn" },
          { startTime: 158969, endTime: 159529, data: "trối" },
          { startTime: 159529, endTime: 159809, data: "em" },
          { startTime: 159809, endTime: 159999, data: "đừng" },
          { startTime: 160109, endTime: 160409, data: "u" },
          { startTime: 160429, endTime: 160749, data: "sầu" },
        ],
      },
      {
        words: [
          { startTime: 162009, endTime: 162269, data: "Gạt" },
          { startTime: 162269, endTime: 162539, data: "lệ" },
          { startTime: 162539, endTime: 162869, data: "thương" },
          { startTime: 162869, endTime: 163219, data: "đau" },
        ],
      },
      {
        words: [
          { startTime: 163599, endTime: 163839, data: "Nếu" },
          { startTime: 163839, endTime: 164349, data: "chúng" },
          { startTime: 164349, endTime: 164530, data: "ta" },
          { startTime: 164540, endTime: 164930, data: "không" },
          { startTime: 164930, endTime: 165299, data: "còn" },
          { startTime: 165309, endTime: 165489, data: "nhau" },
        ],
      },
      {
        words: [
          { startTime: 167769, endTime: 168169, data: "Con" },
          { startTime: 168189, endTime: 168569, data: "đường" },
          { startTime: 168589, endTime: 168829, data: "em" },
          { startTime: 168829, endTime: 168999, data: "và" },
          { startTime: 168999, endTime: 169209, data: "anh" },
          { startTime: 169209, endTime: 169439, data: "nguyện" },
          { startTime: 169439, endTime: 169749, data: "đi" },
          { startTime: 169779, endTime: 170009, data: "suốt" },
          { startTime: 170259, endTime: 170629, data: "đời" },
        ],
      },
      {
        words: [
          { startTime: 171249, endTime: 171630, data: "Một" },
          { startTime: 171630, endTime: 171799, data: "khi" },
          { startTime: 171799, endTime: 172030, data: "không" },
          { startTime: 172030, endTime: 172210, data: "còn" },
          { startTime: 172220, endTime: 172440, data: "anh" },
          { startTime: 172440, endTime: 172590, data: "là" },
          { startTime: 172590, endTime: 172760, data: "qua" },
          { startTime: 173010, endTime: 173329, data: "hết" },
          { startTime: 173329, endTime: 173799, data: "rồi" },
        ],
      },
      {
        words: [
          { startTime: 174569, endTime: 174969, data: "Chỉ" },
          { startTime: 175019, endTime: 175399, data: "mong" },
          { startTime: 175399, endTime: 175649, data: "có" },
          { startTime: 175659, endTime: 175859, data: "ai" },
        ],
      },
      {
        words: [
          { startTime: 176999, endTime: 177389, data: "Cùng" },
          { startTime: 177399, endTime: 177759, data: "em" },
          { startTime: 177759, endTime: 178159, data: "bước" },
          { startTime: 178159, endTime: 178579, data: "tiếp" },
          { startTime: 178579, endTime: 178829, data: "mới" },
          { startTime: 178829, endTime: 179239, data: "vui" },
          { startTime: 179249, endTime: 179450, data: "lòng" },
          { startTime: 179450, endTime: 179470, data: "anh" },
        ],
      },
      {
        words: [
          { startTime: 180149, endTime: 180559, data: "Và" },
          { startTime: 180559, endTime: 180929, data: "hôm" },
          { startTime: 181019, endTime: 181109, data: "nay" },
          { startTime: 181759, endTime: 182220, data: "em" },
          { startTime: 182220, endTime: 182599, data: "đang" },
          { startTime: 182599, endTime: 182809, data: "đi" },
          { startTime: 182809, endTime: 182979, data: "tới" },
        ],
      },
      {
        words: [
          { startTime: 183369, endTime: 183779, data: "Trên" },
          { startTime: 183779, endTime: 184160, data: "đoạn" },
          { startTime: 184219, endTime: 184569, data: "đường" },
          { startTime: 184569, endTime: 185010, data: "mới" },
          { startTime: 185010, endTime: 185420, data: "như" },
          { startTime: 185420, endTime: 185660, data: "lời" },
          { startTime: 185670, endTime: 186150, data: "anh" },
          { startTime: 186160, endTime: 186710, data: "rồi" },
        ],
      },
      {
        words: [
          { startTime: 187569, endTime: 187789, data: "Một" },
          { startTime: 187789, endTime: 188199, data: "hạnh" },
          { startTime: 188199, endTime: 188479, data: "phúc" },
          { startTime: 188479, endTime: 188899, data: "mới" },
          { startTime: 189110, endTime: 189429, data: "em" },
          { startTime: 189429, endTime: 189849, data: "hứa" },
          { startTime: 190339, endTime: 190679, data: "cho" },
          { startTime: 190679, endTime: 191070, data: "anh" },
          { startTime: 191070, endTime: 191350, data: "mỉm" },
          { startTime: 193080, endTime: 193110, data: "cười" },
        ],
      },
      {
        words: [
          { startTime: 193309, endTime: 193709, data: "Cho" },
          { startTime: 193719, endTime: 193929, data: "dù" },
          { startTime: 194179, endTime: 194449, data: "em" },
          { startTime: 194449, endTime: 194599, data: "và" },
          { startTime: 194599, endTime: 194809, data: "ai" },
          { startTime: 194809, endTime: 195049, data: "cùng" },
          { startTime: 195049, endTime: 195219, data: "đi" },
          { startTime: 195299, endTime: 195689, data: "suốt" },
          { startTime: 195689, endTime: 195719, data: "đời" },
        ],
      },
      {
        words: [
          { startTime: 197129, endTime: 197229, data: "Thì" },
          { startTime: 197229, endTime: 197449, data: "vẫn" },
          { startTime: 197449, endTime: 197639, data: "như" },
          { startTime: 197639, endTime: 197869, data: "còn" },
          { startTime: 197879, endTime: 198079, data: "anh" },
          { startTime: 198079, endTime: 198269, data: "cùng" },
          { startTime: 198289, endTime: 198550, data: "em" },
          { startTime: 198550, endTime: 198829, data: "chung" },
          { startTime: 198959, endTime: 199439, data: "lối" },
        ],
      },
      {
        words: [
          { startTime: 199749, endTime: 200179, data: "Em" },
          { startTime: 200309, endTime: 200579, data: "ước" },
          { startTime: 200579, endTime: 200679, data: "rằng" },
        ],
      },
      {
        words: [
          { startTime: 201739, endTime: 201989, data: "Chốn" },
          { startTime: 201989, endTime: 202210, data: "xa" },
          { startTime: 202210, endTime: 202629, data: "xôi" },
          { startTime: 202629, endTime: 202879, data: "anh" },
          { startTime: 202879, endTime: 203080, data: "được" },
          { startTime: 203209, endTime: 203550, data: "yên" },
          { startTime: 203550, endTime: 203580, data: "vui" },
        ],
      },
      {
        words: [
          { startTime: 228209, endTime: 228270, data: "Và" },
          { startTime: 228270, endTime: 228299, data: "hôm" },
          { startTime: 229109, endTime: 229749, data: "nay" },
          { startTime: 229759, endTime: 230199, data: "em" },
          { startTime: 230199, endTime: 230599, data: "đang" },
          { startTime: 230599, endTime: 230809, data: "đi" },
          { startTime: 230809, endTime: 231039, data: "tới" },
        ],
      },
      {
        words: [
          { startTime: 231340, endTime: 231850, data: "Trên" },
          { startTime: 231850, endTime: 232210, data: "đoạn" },
          { startTime: 232220, endTime: 232540, data: "đường" },
          { startTime: 232540, endTime: 232749, data: "mới" },
          { startTime: 233009, endTime: 233299, data: "như" },
          { startTime: 233369, endTime: 233699, data: "lời" },
          { startTime: 233719, endTime: 234039, data: "anh" },
          { startTime: 234039, endTime: 234269, data: "rồi" },
        ],
      },
      {
        words: [
          { startTime: 235520, endTime: 235860, data: "Một" },
          { startTime: 235860, endTime: 236080, data: "hạnh" },
          { startTime: 236229, endTime: 236470, data: "phúc" },
          { startTime: 236550, endTime: 236970, data: "mới" },
          { startTime: 237200, endTime: 237450, data: "em" },
          { startTime: 237819, endTime: 237999, data: "hứa" },
          { startTime: 237999, endTime: 238019, data: "cho" },
          { startTime: 238019, endTime: 238039, data: "anh" },
          { startTime: 239039, endTime: 239460, data: "mỉm" },
          { startTime: 241060, endTime: 241090, data: "cười" },
        ],
      },
      {
        words: [
          { startTime: 242159, endTime: 242179, data: "Cho" },
          { startTime: 242179, endTime: 242199, data: "dù" },
          { startTime: 242209, endTime: 242429, data: "em" },
          { startTime: 242429, endTime: 242449, data: "và" },
          { startTime: 242459, endTime: 244599, data: "ai" },
          { startTime: 244599, endTime: 244629, data: "cùng" },
          { startTime: 244629, endTime: 244649, data: "đi" },
          { startTime: 244649, endTime: 244679, data: "suốt" },
          { startTime: 244679, endTime: 244709, data: "đời" },
        ],
      },
      {
        words: [
          { startTime: 245090, endTime: 245210, data: "Thì" },
          { startTime: 245210, endTime: 245319, data: "vẫn" },
          { startTime: 245319, endTime: 245339, data: "như" },
          { startTime: 245579, endTime: 245790, data: "còn" },
          { startTime: 245790, endTime: 245859, data: "anh" },
          { startTime: 245969, endTime: 246240, data: "cùng" },
          { startTime: 246240, endTime: 246320, data: "em" },
          { startTime: 246530, endTime: 246820, data: "chung" },
          { startTime: 246830, endTime: 247379, data: "lối" },
        ],
      },
      {
        words: [
          { startTime: 247830, endTime: 248609, data: "Em" },
          { startTime: 248609, endTime: 248629, data: "ước" },
          { startTime: 248629, endTime: 248659, data: "rằng" },
        ],
      },
      {
        words: [
          { startTime: 249819, endTime: 249949, data: "Chốn" },
          { startTime: 250029, endTime: 250219, data: "xa" },
          { startTime: 250219, endTime: 250629, data: "xôi" },
          { startTime: 250629, endTime: 250919, data: "anh" },
          { startTime: 250919, endTime: 251070, data: "được" },
          { startTime: 251320, endTime: 251580, data: "yên" },
          { startTime: 252769, endTime: 252799, data: "vui" },
        ],
      },
      {
        words: [
          { startTime: 254169, endTime: 254289, data: "Cho" },
          { startTime: 254559, endTime: 254689, data: "dù" },
          { startTime: 254689, endTime: 254709, data: "em" },
          { startTime: 255229, endTime: 255489, data: "và" },
          { startTime: 255489, endTime: 255609, data: "ai" },
          { startTime: 255609, endTime: 255849, data: "cùng" },
          { startTime: 255849, endTime: 256169, data: "đi" },
          { startTime: 256179, endTime: 256709, data: "suốt" },
          { startTime: 256869, endTime: 257209, data: "đời" },
        ],
      },
      {
        words: [
          { startTime: 257719, endTime: 257990, data: "Thì" },
          { startTime: 257990, endTime: 258149, data: "vẫn" },
          { startTime: 258179, endTime: 258399, data: "như" },
          { startTime: 258399, endTime: 258620, data: "còn" },
          { startTime: 258630, endTime: 258810, data: "anh" },
          { startTime: 258810, endTime: 259050, data: "cùng" },
          { startTime: 259050, endTime: 259130, data: "em" },
          { startTime: 259300, endTime: 259610, data: "chung" },
          { startTime: 259610, endTime: 260189, data: "lối" },
        ],
      },
      {
        words: [
          { startTime: 260659, endTime: 261060, data: "Em" },
          { startTime: 261060, endTime: 261079, data: "ước" },
          { startTime: 261499, endTime: 261939, data: "rằng" },
        ],
      },
      {
        words: [
          { startTime: 262589, endTime: 262759, data: "Chốn" },
          { startTime: 262769, endTime: 263049, data: "xa" },
          { startTime: 263049, endTime: 263489, data: "xôi" },
          { startTime: 263489, endTime: 263899, data: "anh" },
          { startTime: 263899, endTime: 264089, data: "được" },
          { startTime: 265659, endTime: 266129, data: "yên" },
          { startTime: 266689, endTime: 266999, data: "vui" },
        ],
      },
    ],
  },
  timestamp: 1719089720331,
};

var progressBar = document.querySelector(".progress-bar");
var progress = progressBar.querySelector(".progress");
var progressSpan = progress.querySelector("span");

//Tính chiều rộng của progess-bar
var progressBarWidth = progressBar.clientWidth;
var offsetX = 0;
var initialClientX = 0;
var lastOffsetProgressBar = 0;
var offsetProgressBar = 0;
progressBar.addEventListener("mousedown", function (e) {
  //Lấy được tọa độ tại vị trí bấm (offsetX)
  offsetX = e.offsetX;

  //Tính tỷ lệ phần trăm giữa tọa độ bấm xuống và chiều rộng
  var rate = (offsetX / progressBarWidth) * 100;
  //Cập nhật CSS vào progress
  progress.style.width = rate + "%";
  lastOffsetProgressBar = offsetX;
  offsetProgressBar = offsetX;
  initialClientX = e.clientX;
  document.addEventListener("mousemove", handleDrag);
});

progressSpan.addEventListener("mousedown", function (e) {
  e.stopPropagation();
  document.addEventListener("mousemove", handleDrag);
  initialClientX = e.clientX; //Gán ví trí của button màu tím so với body
  document.addEventListener("mouseup", function () {
    audio.currentTime = (rateTime / 100) * duration;
    audio.addEventListener("timeupdate", function () {
      currentTimeEl.innerText = getTime(audio.currentTime);
    });
  });
});
document.addEventListener("mouseup", function () {
  document.removeEventListener("mousemove", handleDrag);
  lastOffsetProgressBar = offsetProgressBar;
});
var handleDrag = function (e) {
  var clientX = e.clientX;
  offsetProgressBar = clientX - initialClientX + lastOffsetProgressBar;
  var rate = (offsetProgressBar / progressBarWidth) * 100;
  if (rate < 0) {
    rate = 0;
  }
  if (rate > 100) {
    rate = 100;
  }
  progress.style.width = rate + "%";
};

var audio = document.querySelector("audio");
var player = document.querySelector(".player");
var playBtn = document.querySelector(".play-btn i");
var playTimer = document.querySelector(".play-timer");
var currentTimeEl = playTimer.firstElementChild;
var durationEl = playTimer.lastElementChild;

console.log(currentTimeEl);
console.log(durationEl);
var duration = 0;
var setDuration = function () {
  duration = audio.duration;
};
var getTime = function (seconds) {
  var mins = Math.floor(seconds / 60);
  seconds = Math.floor(seconds - mins * 60);
  return `${mins < 10 ? "0" + mins : mins}:${
    seconds < 10 ? "0" + seconds : seconds
  }`;
};

window.addEventListener("load", function () {
  setDuration();
  durationEl.innerText = getTime(duration);

  playBtn.addEventListener("click", function () {
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  });
  audio.addEventListener("play", function () {
    playBtn.classList.replace("fa-play", "fa-pause");
    // if()
  });
  audio.addEventListener("pause", function () {
    playBtn.classList.replace("fa-pause", "fa-play");
  });
  audio.addEventListener("timeupdate", function (e) {
    var currentTime = audio.currentTime;
    currentTimeEl.innerText = getTime(currentTime);
    var rate = (currentTime / duration) * 100;
    progress.style.width = `${rate}%`;
    var timeMsSecond = currentTime * 1000;
    console.log(timeMsSecond);
  });
});

// Case hover vào hiện thị trước time
var changeTime = document.querySelector(".change-time");
var rateTime = 0;
// var timeNew = 0;
progressBar.addEventListener("mouseenter", function (e) {
  progressBar.addEventListener("mousemove", function (e) {
    changeTime.classList.add("show");
    changeTime.style.left = `${e.offsetX - 22}px`;
    rateTime = (e.offsetX / progressBar.clientWidth) * 100;
    var timeNew = (rateTime / 100) * duration;
    changeTime.innerText = getTime(timeNew);
  });
  progressSpan.addEventListener("mousemove", function (e) {
    e.stopPropagation();
  });
  //   Case tua
  progressBar.addEventListener("mousedown", function (e) {
    e.stopPropagation();
    audio.currentTime = (rateTime / 100) * duration;
    audio.addEventListener("timeupdate", function () {
      currentTimeEl.innerText = getTime(audio.currentTime);
    });
  });
});
progressBar.addEventListener("mouseleave", function (e) {
  changeTime.classList.remove("show");
});
var karaokeInner = document.querySelector(".karaoke-inner");
var btnKaraoke = document.querySelector(".btn-karaoke");
var karaoke = document.querySelector(".karaoke");
var down = document.querySelector(".item");

// Bật tắt giao diện
btnKaraoke.addEventListener("click", function () {
  karaoke.classList.add("show");
});
down.addEventListener("click", function () {
  karaoke.classList.remove("show");
});
var lyric = lyrics["data"]["sentences"];

// Lấy dữ liệu
function getData(array) {
  var js = array
    .map(function (item) {
      return item["data"];
    })
    .join(" ");
  return js;
}
console.log(getData(lyric[10]["words"]));

// Lấy thời gian bắt đầu
function getTimeCur(array) {
  var js = array.map(function (item) {
    return item["startTime"];
  })[0];
  return js;
}

// Thay đổi lời thoại
audio.addEventListener("timeupdate", function () {
  var currentTime = audio.currentTime;
  var timeCur = currentTime * 1000;
  for (var i = 0; i < lyric.length; i += 2) {
    if (timeCur < getTimeCur(lyric[0]["words"])) {
      karaokeInner.innerHTML = `<div>
                                  <p>Hạnh phúc mới</p>
                                  <p>Ca sĩ: Hari Won, Phạm Quỳnh Anh</p>
                                </div>`;
      break;
    } else if (
      timeCur >= getTimeCur(lyric[i]["words"]) &&
      timeCur <= getTimeCur(lyric[i + 2]["words"])
    ) {
      karaokeInner.innerHTML = `<div>
                                  <p>${getData(lyric[i]["words"])}</p>
                                  <p>${getData(lyric[i + 1]["words"])}</p>
                                </div>`;
      break;
    }
  }
});
